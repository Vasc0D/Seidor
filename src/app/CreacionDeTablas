-- Tabla Clientes
CREATE TABLE Clientes (
  id INT PRIMARY KEY IDENTITY(1,1),
  nombre VARCHAR(255) NOT NULL,
  ruc VARCHAR(20) NOT NULL,
  sociedades INT NOT NULL,
  empleados INT NOT NULL
);

-- Tabla Oportunidades con nombre_op y estado
CREATE TABLE Oportunidades (
  id INT PRIMARY KEY IDENTITY(1,1),
  cliente_id INT NOT NULL,
  nombre_op VARCHAR(255) NOT NULL,  -- Nombre de la oportunidad
  estado VARCHAR(20) NOT NULL DEFAULT 'pendiente',  -- Estado: Ganada o Perdida
  total_venta DECIMAL(10, 2) DEFAULT 0,
  costo_venta DECIMAL(10, 2) DEFAULT 0,
  margen_venta DECIMAL(10, 2) DEFAULT 0,
  FOREIGN KEY (cliente_id) REFERENCES Clientes(id) ON DELETE CASCADE
);

-- Tabla Conceptos
CREATE TABLE Conceptos (
  id INT PRIMARY KEY IDENTITY(1,1),
  oportunidad_id INT NOT NULL,
  nombre_concepto VARCHAR(255) NOT NULL,
  base_datos VARCHAR(50) NULL,  -- Relevante para SAP
  total_venta DECIMAL(10, 2) DEFAULT 0,
  costo_venta DECIMAL(10, 2) DEFAULT 0,
  margen_venta AS (total_venta - costo_venta),
  FOREIGN KEY (oportunidad_id) REFERENCES Oportunidades(id) ON DELETE CASCADE
);

-- Tabla Detalle Conceptos
CREATE TABLE Detalle_Conceptos (
  id INT PRIMARY KEY IDENTITY(1,1),
  concepto_id INT NOT NULL,
  nombre_item VARCHAR(255) NOT NULL,
  cantidad INT NOT NULL,
  costo DECIMAL(10, 2) NOT NULL,
  total AS (cantidad * costo),
  FOREIGN KEY (concepto_id) REFERENCES Conceptos(id) ON DELETE CASCADE
);
